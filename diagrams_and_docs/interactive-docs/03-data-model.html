<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Data Model - SWE Hackers Interactive Docs</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=JetBrains+Mono&family=Space+Grotesk:wght@500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="shared/styles.css">
</head>
<body>
  <header class="header">
    <div class="header-content">
      <a href="index.html" class="logo">
        <div class="logo-icon">‚ö°</div>
        <span>SWE Hackers Docs</span>
      </a>
      <nav class="nav-links">
        <a href="index.html">Home</a>
        <a href="00-overview.html">Overview</a>
        <a href="01-service-layer.html">Services</a>
        <a href="03-data-model.html" class="active">Data Model</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <div class="page-header">
      <div class="breadcrumb">
        <a href="index.html">Docs</a>
        <span>/</span>
        <span>Data Model</span>
      </div>
      <h1>üóÑÔ∏è Firestore Data Model</h1>
      <p>Collection hierarchy, schemas, and entity relationships</p>
    </div>

    <!-- Collection Hierarchy -->
    <section class="section">
      <h2>Collection Hierarchy</h2>
      <p>Firestore uses a hierarchical structure with top-level collections and nested subcollections. User data is organized under the user's document.</p>
      
      <div class="diagram-container">
        <div class="diagram-header">
          <span class="diagram-title">Firestore Collection Structure</span>
          <div class="diagram-controls">
            <button class="diagram-btn" data-action="fit">Fit</button>
            <button class="diagram-btn" data-action="reset">Reset</button>
            <button class="diagram-btn" data-layout="hierarchicalLR">Horizontal</button>
            <button class="diagram-btn" data-action="export">Export PNG</button>
          </div>
        </div>
        <div id="collection-hierarchy" class="diagram-canvas large"></div>
        <div class="diagram-legend">
          <div class="legend-item">
            <div class="legend-dot data"></div>
            <span>Collection</span>
          </div>
          <div class="legend-item">
            <div class="legend-dot service"></div>
            <span>Document</span>
          </div>
          <div class="legend-item">
            <div class="legend-dot page"></div>
            <span>Subcollection</span>
          </div>
        </div>
        <div class="diagram-instructions">
          <span>üñ±Ô∏è Click a collection to see its schema</span>
        </div>
      </div>
    </section>

    <!-- Entity Relationship Diagram -->
    <section class="section">
      <h2>Entity Relationships</h2>
      <p>How different data entities relate to each other across the platform.</p>
      
      <div class="diagram-container">
        <div class="diagram-header">
          <span class="diagram-title">Entity Relationship Diagram</span>
          <div class="diagram-controls">
            <button class="diagram-btn" data-action="fit">Fit</button>
            <button class="diagram-btn" data-action="reset">Reset</button>
            <button class="diagram-btn" data-layout="force">Physics</button>
            <button class="diagram-btn" data-action="export">Export PNG</button>
          </div>
        </div>
        <div id="entity-relations" class="diagram-canvas large"></div>
        <div class="diagram-legend">
          <div class="legend-item">
            <div class="legend-dot auth"></div>
            <span>User Entity</span>
          </div>
          <div class="legend-item">
            <div class="legend-dot service"></div>
            <span>Progress Entity</span>
          </div>
          <div class="legend-item">
            <div class="legend-dot page"></div>
            <span>Activity Entity</span>
          </div>
          <div class="legend-item">
            <div class="legend-dot data"></div>
            <span>Content Entity</span>
          </div>
        </div>
        <div class="diagram-instructions">
          <span>üîç Hover over entities to see their relationships</span>
        </div>
      </div>
    </section>

    <!-- User Document Schema -->
    <section class="section">
      <h2>User Document Schema</h2>
      <p>The <code>users/{uid}</code> document stores user profile and permissions.</p>
      
      <div class="diagram-container">
        <div class="diagram-header">
          <span class="diagram-title">User Document Structure</span>
          <div class="diagram-controls">
            <button class="diagram-btn" data-action="fit">Fit</button>
            <button class="diagram-btn" data-action="export">Export PNG</button>
          </div>
        </div>
        <div id="user-schema" class="diagram-canvas"></div>
      </div>

      <div class="code-block">
        <div class="code-header">
          <span class="code-lang">TypeScript</span>
          <button class="code-copy" onclick="navigator.clipboard.writeText(this.closest('.code-block').querySelector('pre').textContent)">Copy</button>
        </div>
        <pre><code>interface UserDocument {
  uid: string;
  email: string;
  displayName: string;
  photoURL?: string;
  
  // RBAC
  role: 'user' | 'enterprise' | 'admin';
  organizations?: string[];
  courseAccess?: string[];
  
  // Tracking
  createdAt: Timestamp;
  lastLogin: Timestamp;
  currentStreak: number;
  longestStreak: number;
}</code></pre>
      </div>
    </section>

    <!-- Progress Data Flow -->
    <section class="section">
      <h2>Progress Data Flow</h2>
      <p>Progress data flows from lesson pages through the service layer to Firestore, with a dual-write pattern for dashboard optimization.</p>
      
      <div class="diagram-container">
        <div class="diagram-header">
          <span class="diagram-title">Progress Save Flow</span>
          <div class="diagram-controls">
            <button class="diagram-btn" data-action="fit">Fit</button>
            <button class="diagram-btn" data-action="reset">Reset</button>
            <button class="diagram-btn" data-action="export">Export PNG</button>
          </div>
        </div>
        <div id="progress-flow" class="diagram-canvas"></div>
        <div class="diagram-instructions">
          <span>üîç Follow the data path from user action to storage</span>
        </div>
      </div>

      <div class="info-box warning">
        <h4>‚ö†Ô∏è Critical: Dual-Write Pattern</h4>
        <p>Progress is written to BOTH:</p>
        <ul style="margin-top: 0.5rem; padding-left: 1.5rem;">
          <li><code>courseProgress/{courseId}/lessonProgress/{lessonId}</code> (subcollection - detailed data)</li>
          <li><code>courseProgress/{courseId}.lessons</code> (parent field - summary for dashboard)</li>
        </ul>
        <p style="margin-top: 0.5rem;">If the parent field is empty, dashboard falls back to reading subcollections.</p>
      </div>
    </section>

    <!-- Activity Attempts Schema -->
    <section class="section">
      <h2>Activity Attempts Schema</h2>
      <p>Each quiz answer, drag-drop completion, or code challenge is recorded as an activity attempt.</p>
      
      <div class="diagram-container">
        <div class="diagram-header">
          <span class="diagram-title">Activity Attempt Structure</span>
          <div class="diagram-controls">
            <button class="diagram-btn" data-action="fit">Fit</button>
            <button class="diagram-btn" data-action="export">Export PNG</button>
          </div>
        </div>
        <div id="activity-schema" class="diagram-canvas"></div>
      </div>

      <div class="code-block">
        <div class="code-header">
          <span class="code-lang">TypeScript</span>
          <button class="code-copy" onclick="navigator.clipboard.writeText(this.closest('.code-block').querySelector('pre').textContent)">Copy</button>
        </div>
        <pre><code>interface ActivityAttempt {
  activityId: string;
  activityType: 'quiz' | 'drag-drop' | 'code' | 'demo';
  courseId: string;
  lessonId: string;
  
  // Result
  correct: boolean;
  selectedAnswer?: string;
  correctAnswer?: string;
  score?: number;
  
  // Timing
  timestamp: Timestamp;
  timeSpent?: number;  // milliseconds
}</code></pre>
      </div>
    </section>

    <!-- Dashboard Data Requirements -->
    <section class="section">
      <h2>Dashboard Data Requirements</h2>
      <p>The dashboard needs data from multiple collections to render all its components.</p>
      
      <div class="diagram-container">
        <div class="diagram-header">
          <span class="diagram-title">Dashboard Data Sources</span>
          <div class="diagram-controls">
            <button class="diagram-btn" data-action="fit">Fit</button>
            <button class="diagram-btn" data-action="reset">Reset</button>
            <button class="diagram-btn" data-layout="concentric">Concentric</button>
            <button class="diagram-btn" data-action="export">Export PNG</button>
          </div>
        </div>
        <div id="dashboard-data" class="diagram-canvas large"></div>
        <div class="diagram-legend">
          <div class="legend-item">
            <div class="legend-dot" style="background: #42a5f5;"></div>
            <span>UI Component</span>
          </div>
          <div class="legend-item">
            <div class="legend-dot service"></div>
            <span>Calculation</span>
          </div>
          <div class="legend-item">
            <div class="legend-dot data"></div>
            <span>Data Source</span>
          </div>
        </div>
        <div class="diagram-instructions">
          <span>üñ±Ô∏è Click a UI component to see its data dependencies</span>
        </div>
      </div>
    </section>

    <!-- Collection Reference -->
    <section class="section">
      <h2>Collection Reference</h2>
      
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>Collection Path</th>
              <th>Type</th>
              <th>Description</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><code>users/{uid}</code></td>
              <td>Document</td>
              <td>User profile, role, organizations</td>
            </tr>
            <tr>
              <td><code>users/{uid}/courseProgress/{courseId}</code></td>
              <td>Subcollection</td>
              <td>Course-level progress summary</td>
            </tr>
            <tr>
              <td><code>users/{uid}/courseProgress/{courseId}/lessonProgress/{lessonId}</code></td>
              <td>Subcollection</td>
              <td>Detailed lesson progress</td>
            </tr>
            <tr>
              <td><code>users/{uid}/courseProgress/{courseId}/activityAttempts/{attemptId}</code></td>
              <td>Subcollection</td>
              <td>Individual activity attempts</td>
            </tr>
            <tr>
              <td><code>users/{uid}/dailyChallenges/{date}</code></td>
              <td>Subcollection</td>
              <td>Daily challenge completions</td>
            </tr>
            <tr>
              <td><code>users/{uid}/notes/{noteId}</code></td>
              <td>Subcollection</td>
              <td>User notes per lesson</td>
            </tr>
            <tr>
              <td><code>courses/{courseId}</code></td>
              <td>Collection</td>
              <td>Course metadata (optional, can be static)</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- Navigation -->
    <section class="section">
      <h2>Next Steps</h2>
      <div class="cards-grid" style="grid-template-columns: repeat(2, 1fr);">
        <a href="04-authentication-rbac.html" class="card">
          <div class="card-icon">üîê</div>
          <h3>Authentication & RBAC</h3>
          <p>How user data relates to access control.</p>
        </a>
        <a href="05-progress-tracking.html" class="card">
          <div class="card-icon">üìä</div>
          <h3>Progress Tracking</h3>
          <p>Deep dive into how progress data is collected.</p>
        </a>
      </div>
    </section>
  </main>

  <nav class="page-nav">
    <h4>On This Page</h4>
    <ul>
      <li><a href="#collection-hierarchy">Hierarchy</a></li>
      <li><a href="#entity-relations">Relationships</a></li>
      <li><a href="#user-schema">User Schema</a></li>
      <li><a href="#progress-flow">Progress Flow</a></li>
      <li><a href="#activity-schema">Activities</a></li>
      <li><a href="#dashboard-data">Dashboard</a></li>
    </ul>
  </nav>

  <button class="back-to-top" title="Back to top">‚Üë</button>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.2/anime.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.28.1/cytoscape.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/dagre/0.8.5/dagre.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/cytoscape-dagre@2.5.0/cytoscape-dagre.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/cytoscape-cose-bilkent@4.1.0/cytoscape-cose-bilkent.min.js"></script>
  <script src="shared/diagram-utils.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      DiagramUtils.initPageAnimations();
      DiagramUtils.setupBackToTop();

      // ============================================
      // DIAGRAM 1: Collection Hierarchy
      // ============================================
      const hierarchyElements = [
        // Root
        { data: { id: 'firestore', label: 'Firestore', type: 'data', description: 'Root database' } },
        
        // Top-level collections
        { data: { id: 'users-col', label: 'users', type: 'data', description: 'User documents collection' } },
        { data: { id: 'courses-col', label: 'courses', type: 'data', description: 'Course metadata (optional)' } },
        
        // User document
        { data: { id: 'user-doc', label: '{uid}', type: 'service', description: 'Individual user document' } },
        
        // User subcollections
        { data: { id: 'course-progress', label: 'courseProgress', type: 'page', description: 'Per-course progress' } },
        { data: { id: 'daily-challenges', label: 'dailyChallenges', type: 'page', description: 'Challenge completions' } },
        { data: { id: 'notes', label: 'notes', type: 'page', description: 'User notes' } },
        
        // Course progress document
        { data: { id: 'course-doc', label: '{courseId}', type: 'service', description: 'Course progress document' } },
        
        // Lesson subcollections
        { data: { id: 'lesson-progress', label: 'lessonProgress', type: 'page', description: 'Per-lesson progress' } },
        { data: { id: 'activity-attempts', label: 'activityAttempts', type: 'page', description: 'Activity attempts' } },
        
        // Leaf documents
        { data: { id: 'lesson-doc', label: '{lessonId}', type: 'service', description: 'Lesson progress doc' } },
        { data: { id: 'attempt-doc', label: '{attemptId}', type: 'service', description: 'Activity attempt doc' } },
        
        // Edges
        { data: { source: 'firestore', target: 'users-col' } },
        { data: { source: 'firestore', target: 'courses-col' } },
        { data: { source: 'users-col', target: 'user-doc' } },
        { data: { source: 'user-doc', target: 'course-progress' } },
        { data: { source: 'user-doc', target: 'daily-challenges' } },
        { data: { source: 'user-doc', target: 'notes' } },
        { data: { source: 'course-progress', target: 'course-doc' } },
        { data: { source: 'course-doc', target: 'lesson-progress' } },
        { data: { source: 'course-doc', target: 'activity-attempts' } },
        { data: { source: 'lesson-progress', target: 'lesson-doc' } },
        { data: { source: 'activity-attempts', target: 'attempt-doc' } },
      ];

      const cyHierarchy = DiagramUtils.createDiagram('collection-hierarchy', hierarchyElements, {
        layout: DiagramUtils.LAYOUTS.hierarchical
      });
      DiagramUtils.setupDiagramControls(cyHierarchy, 'collection-hierarchy');

      // ============================================
      // DIAGRAM 2: Entity Relationships
      // ============================================
      const entityElements = [
        // Entities
        { data: { id: 'user', label: 'User', type: 'auth', description: 'Platform user account' } },
        { data: { id: 'course', label: 'Course', type: 'data', description: 'Learning course (apprentice, junior, etc)' } },
        { data: { id: 'lesson', label: 'Lesson', type: 'data', description: 'Individual lesson in a course' } },
        { data: { id: 'activity', label: 'Activity', type: 'data', description: 'Quiz, drag-drop, code challenge' } },
        { data: { id: 'progress', label: 'Progress', type: 'service', description: 'User progress on a lesson' } },
        { data: { id: 'attempt', label: 'Attempt', type: 'page', description: 'Single activity attempt' } },
        { data: { id: 'organization', label: 'Organization', type: 'auth', description: 'Partner organization' } },
        { data: { id: 'note', label: 'Note', type: 'page', description: 'User note on a lesson' } },
        
        // Relationships
        { data: { source: 'user', target: 'progress', label: 'has many' } },
        { data: { source: 'user', target: 'attempt', label: 'makes' } },
        { data: { source: 'user', target: 'note', label: 'writes' } },
        { data: { source: 'user', target: 'organization', label: 'belongs to' } },
        { data: { source: 'course', target: 'lesson', label: 'contains' } },
        { data: { source: 'lesson', target: 'activity', label: 'contains' } },
        { data: { source: 'progress', target: 'course', label: 'for' } },
        { data: { source: 'progress', target: 'lesson', label: 'for' } },
        { data: { source: 'attempt', target: 'activity', label: 'for' } },
        { data: { source: 'note', target: 'lesson', label: 'about' } },
        { data: { source: 'organization', target: 'course', label: 'sponsors', type: 'optional' } },
      ];

      const cyEntity = DiagramUtils.createDiagram('entity-relations', entityElements, {
        layout: {
          name: 'cose',
          padding: 50,
          nodeRepulsion: 8000,
          idealEdgeLength: 120,
          animate: false
        }
      });
      DiagramUtils.setupDiagramControls(cyEntity, 'entity-relations');

      // ============================================
      // DIAGRAM 3: User Schema
      // ============================================
      const userSchemaElements = [
        { data: { id: 'user-doc', label: 'users/{uid}', type: 'data', description: 'User document' } },
        
        // Identity fields
        { data: { id: 'uid', label: 'uid: string', type: 'service', description: 'Firebase Auth UID' } },
        { data: { id: 'email', label: 'email: string', type: 'service', description: 'User email address' } },
        { data: { id: 'displayName', label: 'displayName: string', type: 'service', description: 'Display name' } },
        { data: { id: 'photoURL', label: 'photoURL?: string', type: 'service', description: 'Profile photo URL' } },
        
        // RBAC fields
        { data: { id: 'role', label: 'role: string', type: 'auth', description: 'user | enterprise | admin' } },
        { data: { id: 'orgs', label: 'organizations?: []', type: 'auth', description: 'Organization memberships' } },
        { data: { id: 'courseAccess', label: 'courseAccess?: []', type: 'auth', description: 'Accessible courses' } },
        
        // Tracking
        { data: { id: 'created', label: 'createdAt: Timestamp', type: 'page', description: 'Account creation time' } },
        { data: { id: 'lastLogin', label: 'lastLogin: Timestamp', type: 'page', description: 'Last login time' } },
        { data: { id: 'streak', label: 'currentStreak: number', type: 'page', description: 'Current active streak' } },
        
        // Edges
        { data: { source: 'user-doc', target: 'uid' } },
        { data: { source: 'user-doc', target: 'email' } },
        { data: { source: 'user-doc', target: 'displayName' } },
        { data: { source: 'user-doc', target: 'photoURL' } },
        { data: { source: 'user-doc', target: 'role' } },
        { data: { source: 'user-doc', target: 'orgs' } },
        { data: { source: 'user-doc', target: 'courseAccess' } },
        { data: { source: 'user-doc', target: 'created' } },
        { data: { source: 'user-doc', target: 'lastLogin' } },
        { data: { source: 'user-doc', target: 'streak' } },
      ];

      const cyUserSchema = DiagramUtils.createDiagram('user-schema', userSchemaElements, {
        layout: {
          name: 'cose',
          padding: 30,
          nodeRepulsion: 4000,
          idealEdgeLength: 60,
          animate: false
        }
      });
      DiagramUtils.setupDiagramControls(cyUserSchema, 'user-schema');

      // ============================================
      // DIAGRAM 4: Progress Save Flow
      // ============================================
      const progressElements = [
        { data: { id: 'scroll', label: 'User Scrolls', type: 'external', description: 'User scrolls to new section' } },
        { data: { id: 'observer', label: 'IntersectionObserver', type: 'service', description: 'Detects section visibility' } },
        { data: { id: 'tracker', label: 'ProgressTracker', type: 'service', description: 'Updates viewed sections' } },
        { data: { id: 'calc-progress', label: 'Calculate %', type: 'service', description: 'viewedSections / totalSections' } },
        { data: { id: 'data-service', label: 'DataService', type: 'service', description: 'saveLessonProgress()' } },
        
        // Dual write targets
        { data: { id: 'subcol', label: 'lessonProgress/{id}', type: 'data', description: 'Subcollection document' } },
        { data: { id: 'parent', label: 'courseProgress.lessons', type: 'data', description: 'Parent document field' } },
        
        // Edges
        { data: { source: 'scroll', target: 'observer' } },
        { data: { source: 'observer', target: 'tracker' } },
        { data: { source: 'tracker', target: 'calc-progress' } },
        { data: { source: 'calc-progress', target: 'data-service' } },
        { data: { source: 'data-service', target: 'subcol', type: 'data' } },
        { data: { source: 'data-service', target: 'parent', type: 'data' } },
      ];

      const cyProgress = DiagramUtils.createDiagram('progress-flow', progressElements, {
        layout: DiagramUtils.LAYOUTS.hierarchicalLR
      });
      DiagramUtils.setupDiagramControls(cyProgress, 'progress-flow');

      // ============================================
      // DIAGRAM 5: Activity Schema
      // ============================================
      const activitySchemaElements = [
        { data: { id: 'attempt-doc', label: 'activityAttempts/{id}', type: 'data', description: 'Activity attempt document' } },
        
        // Identity
        { data: { id: 'activityId', label: 'activityId: string', type: 'service', description: 'Unique activity identifier' } },
        { data: { id: 'activityType', label: 'activityType: string', type: 'service', description: 'quiz | drag-drop | code | demo' } },
        { data: { id: 'courseId', label: 'courseId: string', type: 'service', description: 'Parent course' } },
        { data: { id: 'lessonId', label: 'lessonId: string', type: 'service', description: 'Parent lesson' } },
        
        // Result
        { data: { id: 'correct', label: 'correct: boolean', type: 'page', description: 'Was answer correct?' } },
        { data: { id: 'selected', label: 'selectedAnswer?: string', type: 'page', description: 'User\'s answer' } },
        { data: { id: 'correctAns', label: 'correctAnswer?: string', type: 'page', description: 'Correct answer' } },
        
        // Timing
        { data: { id: 'timestamp', label: 'timestamp: Timestamp', type: 'auth', description: 'When attempt was made' } },
        { data: { id: 'timeSpent', label: 'timeSpent?: number', type: 'auth', description: 'Time spent in ms' } },
        
        // Edges
        { data: { source: 'attempt-doc', target: 'activityId' } },
        { data: { source: 'attempt-doc', target: 'activityType' } },
        { data: { source: 'attempt-doc', target: 'courseId' } },
        { data: { source: 'attempt-doc', target: 'lessonId' } },
        { data: { source: 'attempt-doc', target: 'correct' } },
        { data: { source: 'attempt-doc', target: 'selected' } },
        { data: { source: 'attempt-doc', target: 'correctAns' } },
        { data: { source: 'attempt-doc', target: 'timestamp' } },
        { data: { source: 'attempt-doc', target: 'timeSpent' } },
      ];

      const cyActivitySchema = DiagramUtils.createDiagram('activity-schema', activitySchemaElements, {
        layout: {
          name: 'cose',
          padding: 30,
          nodeRepulsion: 4000,
          idealEdgeLength: 60,
          animate: false
        }
      });
      DiagramUtils.setupDiagramControls(cyActivitySchema, 'activity-schema');

      // ============================================
      // DIAGRAM 6: Dashboard Data Sources
      // ============================================
      const dashboardDataElements = [
        // UI Components
        { data: { id: 'stats-cards', label: 'Stats Cards', type: 'ui', description: 'Velocity, Mastery, Streak' } },
        { data: { id: 'course-grid', label: 'Course Grid', type: 'ui', description: 'Enrolled courses with progress' } },
        { data: { id: 'activity-feed', label: 'Activity Feed', type: 'ui', description: 'Recent activity list' } },
        { data: { id: 'profile-bar', label: 'Profile Bar', type: 'ui', description: 'User name and photo' } },
        
        // Calculations
        { data: { id: 'calc-velocity', label: 'calcVelocity()', type: 'service', description: 'Lessons per week' } },
        { data: { id: 'calc-mastery', label: 'calcMastery()', type: 'service', description: 'Quiz score average' } },
        { data: { id: 'calc-streak', label: 'calcStreak()', type: 'service', description: 'Consecutive days' } },
        { data: { id: 'calc-progress', label: 'calcProgress()', type: 'service', description: 'Course completion %' } },
        
        // Data sources
        { data: { id: 'user-doc', label: 'users/{uid}', type: 'data', description: 'User profile' } },
        { data: { id: 'progress-col', label: 'courseProgress', type: 'data', description: 'Course progress docs' } },
        { data: { id: 'lesson-col', label: 'lessonProgress', type: 'data', description: 'Lesson progress docs' } },
        { data: { id: 'activity-col', label: 'activityAttempts', type: 'data', description: 'Activity attempts' } },
        { data: { id: 'challenge-col', label: 'dailyChallenges', type: 'data', description: 'Daily challenges' } },
        
        // UI to calc edges
        { data: { source: 'stats-cards', target: 'calc-velocity' } },
        { data: { source: 'stats-cards', target: 'calc-mastery' } },
        { data: { source: 'stats-cards', target: 'calc-streak' } },
        { data: { source: 'course-grid', target: 'calc-progress' } },
        { data: { source: 'activity-feed', target: 'activity-col' } },
        { data: { source: 'profile-bar', target: 'user-doc' } },
        
        // Calc to data edges
        { data: { source: 'calc-velocity', target: 'lesson-col', type: 'data' } },
        { data: { source: 'calc-mastery', target: 'activity-col', type: 'data' } },
        { data: { source: 'calc-streak', target: 'challenge-col', type: 'data' } },
        { data: { source: 'calc-streak', target: 'user-doc', type: 'data' } },
        { data: { source: 'calc-progress', target: 'progress-col', type: 'data' } },
        { data: { source: 'calc-progress', target: 'lesson-col', type: 'data' } },
      ];

      const cyDashboardData = DiagramUtils.createDiagram('dashboard-data', dashboardDataElements, {
        layout: {
          name: 'cose',
          padding: 50,
          nodeRepulsion: 6000,
          idealEdgeLength: 100,
          animate: false
        }
      });
      DiagramUtils.setupDiagramControls(cyDashboardData, 'dashboard-data');
    });
  </script>
</body>
</html>
