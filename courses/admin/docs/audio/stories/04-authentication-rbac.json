{
  "pageId": "04-authentication-rbac",
  "stories": [
    {
      "id": "auth-architecture-story",
      "diagramId": "auth-architecture",
      "title": "Authentication Architecture",
      "steps": [
        {
          "nodeId": "user",
          "icon": "ğŸ‘¤",
          "title": "The User",
          "narration": "Every authentication journey starts with a user. They want to log in, access their progress, and continue learning.",
          "connectsTo": null
        },
        {
          "nodeId": "auth-service",
          "edges": [{ "from": "user", "to": "auth-service" }],
          "icon": "âš™ï¸",
          "title": "AuthService",
          "narration": "AuthService is the gateway. It provides clean methods for login, registration, and logoutâ€”wrapping Firebase's complexity.",
          "connectsTo": "User"
        },
        {
          "nodeId": "firebase-auth",
          "edges": [{ "from": "auth-service", "to": "firebase-auth" }],
          "icon": "ğŸ”¥",
          "title": "Firebase Auth",
          "narration": "Firebase Auth handles the heavy lifting. Token management, session persistence, OAuth flowsâ€”all handled securely by Google's infrastructure.",
          "connectsTo": "AuthService"
        },
        {
          "nodeId": "google",
          "edges": [{ "from": "firebase-auth", "to": "google" }],
          "icon": "ğŸ”µ",
          "title": "Google OAuth",
          "narration": "For Google login, Firebase connects to Google's OAuth servers. One-click authentication using existing Google accounts!",
          "connectsTo": "Firebase Auth"
        },
        {
          "nodeId": "auth-state",
          "edges": [{ "from": "firebase-auth", "to": "auth-state" }],
          "icon": "ğŸ”„",
          "title": "Auth State",
          "narration": "Auth State manages the user's session. It tracks whether someone is logged in, handles token refresh, and persists across browser tabs.",
          "connectsTo": "Firebase Auth"
        },
        {
          "nodeId": "user-doc",
          "edges": [{ "from": "auth-service", "to": "user-doc" }],
          "icon": "ğŸ“„",
          "title": "User Document",
          "narration": "After authentication, we sync with Firestore. The user document stores profile info, roles, and organization memberships.",
          "connectsTo": "AuthService"
        }
      ]
    },
    {
      "id": "registration-flow-story",
      "diagramId": "registration-flow",
      "title": "Registration Flow",
      "steps": [
        {
          "nodeId": "form",
          "icon": "ğŸ“",
          "title": "Registration Form",
          "narration": "New users start with the registration form. They enter email, password, and display nameâ€”the essentials for creating an account.",
          "connectsTo": null
        },
        {
          "nodeId": "validate",
          "edges": [{ "from": "form", "to": "validate" }],
          "icon": "âœ…",
          "title": "Input Validation",
          "narration": "Before hitting Firebase, we validate locally. Is the email formatted correctly? Is the password strong enough? Catch errors early!",
          "connectsTo": "Registration Form"
        },
        {
          "nodeId": "create-auth",
          "edges": [{ "from": "validate", "to": "create-auth" }],
          "icon": "ğŸ”",
          "title": "Create Auth Account",
          "narration": "createUserWithEmailAndPassword creates the Firebase Auth account. A unique UID is generatedâ€”the user's permanent identifier.",
          "connectsTo": "Validate Input"
        },
        {
          "nodeId": "update-profile",
          "edges": [{ "from": "create-auth", "to": "update-profile" }],
          "icon": "âœï¸",
          "title": "Update Profile",
          "narration": "updateProfile sets the display name on the Firebase Auth record. This makes the name available immediately across all Firebase services.",
          "connectsTo": "Create Auth"
        },
        {
          "nodeId": "create-doc",
          "edges": [{ "from": "update-profile", "to": "create-doc" }],
          "icon": "ğŸ“„",
          "title": "Create User Document",
          "narration": "With auth complete, we create the Firestore user document. Profile info, default role, creation timestampâ€”everything initialized!",
          "connectsTo": "Update Profile"
        },
        {
          "nodeId": "state-change",
          "edges": [{ "from": "create-doc", "to": "state-change" }],
          "icon": "ğŸ””",
          "title": "Auth State Change",
          "narration": "onAuthStateChanged fires across the app. Every component listening knows a new user just logged in. Time to update the UI!",
          "connectsTo": "Create Doc"
        },
        {
          "nodeId": "redirect",
          "edges": [{ "from": "state-change", "to": "redirect" }],
          "icon": "ğŸš€",
          "title": "Welcome to Dashboard",
          "narration": "Registration complete! Auth state changes, listeners fire, and the user lands on their brand new dashboard. Learning begins!",
          "connectsTo": "State Change"
        }
      ]
    },
    {
      "id": "role-hierarchy-story",
      "diagramId": "role-hierarchy",
      "title": "Role Hierarchy",
      "steps": [
        {
          "nodeId": "admin",
          "icon": "ğŸ‘‘",
          "title": "Admin Role",
          "narration": "At the top sits the admin role. Full platform accessâ€”all courses, user management, organization controls. The keys to the kingdom!",
          "connectsTo": null
        },
        {
          "nodeId": "enterprise",
          "edges": [{ "from": "admin", "to": "enterprise" }],
          "icon": "ğŸ¢",
          "title": "Enterprise Role",
          "narration": "Enterprise users belong to organizations. They inherit all standard user permissions PLUS access to partner courses for their org.",
          "connectsTo": "Admin"
        },
        {
          "nodeId": "user",
          "edges": [{ "from": "enterprise", "to": "user" }],
          "icon": "ğŸ‘¤",
          "title": "Standard User",
          "narration": "Standard users form the base. Public courses, personal dashboard, progress tracking. Everything needed for self-paced learning!",
          "connectsTo": "Enterprise"
        },
        {
          "nodeId": "perm-public",
          "edges": [{ "from": "user", "to": "perm-public" }],
          "icon": "ğŸ“š",
          "title": "Public Course Access",
          "narration": "Standard users can access all public courses. Apprentice, Junior, Seniorâ€”the full curriculum is open to everyone who registers.",
          "connectsTo": "Standard User"
        },
        {
          "nodeId": "perm-dashboard",
          "edges": [{ "from": "user", "to": "perm-dashboard" }],
          "icon": "ğŸ“Š",
          "title": "Dashboard Access",
          "narration": "Every user gets a personal dashboard. Track progress, see achievements, pick up where you left off. Your learning command center!",
          "connectsTo": "Standard User"
        },
        {
          "nodeId": "perm-partner",
          "edges": [{ "from": "enterprise", "to": "perm-partner" }],
          "icon": "ğŸ¤",
          "title": "Partner Course Access",
          "narration": "Enterprise users unlock partner courses. Organization-specific content tailored to their learning path and requirements.",
          "connectsTo": "Enterprise"
        },
        {
          "nodeId": "perm-admin",
          "edges": [{ "from": "admin", "to": "perm-admin" }],
          "icon": "ğŸ”§",
          "title": "Admin Tools",
          "narration": "Admins get special tools. User management, content administration, analytics dashboardsâ€”the backend of the platform.",
          "connectsTo": "Admin"
        },
        {
          "nodeId": "perm-all",
          "edges": [{ "from": "admin", "to": "perm-all" }],
          "icon": "ğŸŒŸ",
          "title": "All Courses Access",
          "narration": "Admins can access every courseâ€”public, partner, or otherwise. Nothing is hidden from the platform administrators.",
          "connectsTo": "Admin"
        },
        {
          "nodeId": "res-apprentice",
          "edges": [{ "from": "perm-public", "to": "res-apprentice" }],
          "icon": "ğŸŒ±",
          "title": "Apprentice Course",
          "narration": "Apprentice is the first public course. Git fundamentals, command line basicsâ€”the foundation for every developer's journey.",
          "connectsTo": "Public Access"
        },
        {
          "nodeId": "res-junior",
          "edges": [{ "from": "perm-public", "to": "res-junior" }],
          "icon": "ğŸ“—",
          "title": "Junior Course",
          "narration": "Junior level builds on Apprentice. More advanced topics, collaborative workflows, professional practices.",
          "connectsTo": "Public Access"
        },
        {
          "nodeId": "res-eo",
          "edges": [{ "from": "perm-partner", "to": "res-eo" }],
          "icon": "ğŸ¯",
          "title": "Endless Opportunities",
          "narration": "Endless Opportunities is a partner-exclusive course. Custom content for a specific organization's learning needs.",
          "connectsTo": "Partner Access"
        },
        {
          "nodeId": "res-admin-page",
          "edges": [{ "from": "perm-admin", "to": "res-admin-page" }],
          "icon": "âš™ï¸",
          "title": "Admin Dashboard",
          "narration": "The admin dashboard is locked tight. User lists, organization management, system metricsâ€”for platform administrators only.",
          "connectsTo": "Admin Tools"
        }
      ]
    },
    {
      "id": "access-check-story",
      "diagramId": "access-check",
      "title": "RBAC Access Check",
      "steps": [
        {
          "nodeId": "request",
          "icon": "ğŸšª",
          "title": "Access Request",
          "narration": "A user wants a protected resource. The RBAC system activatesâ€”a series of checks to determine if access is allowed.",
          "connectsTo": null
        },
        {
          "nodeId": "auth-check",
          "edges": [{ "from": "request", "to": "auth-check" }],
          "icon": "ğŸ”",
          "title": "Authentication Check",
          "narration": "First gate: Is there a valid user session? No login means no access. Redirect to the login page immediately.",
          "connectsTo": "Access Request"
        },
        {
          "nodeId": "no-auth",
          "edges": [{ "from": "auth-check", "to": "no-auth" }],
          "icon": "ğŸš«",
          "title": "Redirect to Login",
          "narration": "No authentication found! The user is redirected to the login page. Come back after you've signed in.",
          "connectsTo": "Auth Check"
        },
        {
          "nodeId": "get-perms",
          "edges": [{ "from": "auth-check", "to": "get-perms" }],
          "icon": "ğŸ“‹",
          "title": "Get Permissions",
          "narration": "User is authenticated! Now we load their RBAC dataâ€”role, organizations, granted permissions. What can they do?",
          "connectsTo": "Auth Check"
        },
        {
          "nodeId": "admin-check",
          "edges": [{ "from": "get-perms", "to": "admin-check" }],
          "icon": "ğŸ‘‘",
          "title": "Admin Bypass",
          "narration": "Admins get VIP treatmentâ€”they bypass all other checks! If role equals admin, access is granted immediately.",
          "connectsTo": "Get Permissions"
        },
        {
          "nodeId": "allow-admin",
          "edges": [{ "from": "admin-check", "to": "allow-admin" }],
          "icon": "âœ…",
          "title": "Admin Allowed",
          "narration": "Admin role confirmed! Access granted without further checks. Admins can go anywhere on the platform.",
          "connectsTo": "Admin Check"
        },
        {
          "nodeId": "course-req",
          "edges": [{ "from": "admin-check", "to": "course-req" }],
          "icon": "ğŸ“",
          "title": "Course Requirements",
          "narration": "Not an admin? Check what the course requires. Is it public? Does it need organization membership? Let's find out.",
          "connectsTo": "Admin Check"
        },
        {
          "nodeId": "public-check",
          "edges": [{ "from": "course-req", "to": "public-check" }],
          "icon": "ğŸŒ",
          "title": "Public Course Check",
          "narration": "Is this a public course? If yes, any authenticated user can access. No further checks needed!",
          "connectsTo": "Course Requirements"
        },
        {
          "nodeId": "allow-public",
          "edges": [{ "from": "public-check", "to": "allow-public" }],
          "icon": "âœ…",
          "title": "Public Allowed",
          "narration": "It's a public course! Any logged-in user can access. Welcome to the free content!",
          "connectsTo": "Public Check"
        },
        {
          "nodeId": "org-check",
          "edges": [{ "from": "public-check", "to": "org-check" }],
          "icon": "ğŸ¢",
          "title": "Organization Check",
          "narration": "For partner courses, verify organization membership. The user's organizations array must include the required org.",
          "connectsTo": "Public Check"
        },
        {
          "nodeId": "deny-org",
          "edges": [{ "from": "org-check", "to": "deny-org" }],
          "icon": "âŒ",
          "title": "Not in Organization",
          "narration": "User isn't in the required organization. Access denied! Contact your admin to get added to the org.",
          "connectsTo": "Org Check"
        },
        {
          "nodeId": "course-check",
          "edges": [{ "from": "org-check", "to": "course-check" }],
          "icon": "ğŸ”",
          "title": "Course Access Check",
          "narration": "User is in the organization! But does their membership include this specific course? One more check to go.",
          "connectsTo": "Org Check"
        },
        {
          "nodeId": "allow-course",
          "edges": [{ "from": "course-check", "to": "allow-course" }],
          "icon": "âœ…",
          "title": "Access Granted!",
          "narration": "All checks passed! The user has the right role, belongs to the right org, and has course access. Welcome in!",
          "connectsTo": "Course Check"
        },
        {
          "nodeId": "deny-course",
          "edges": [{ "from": "course-check", "to": "deny-course" }],
          "icon": "âŒ",
          "title": "Access Denied",
          "narration": "Organization membership confirmed, but this course isn't included. Ask your organization admin for access.",
          "connectsTo": "Course Check"
        }
      ]
    },
    {
      "id": "route-guard-story",
      "diagramId": "route-guard",
      "title": "RouteGuard System",
      "steps": [
        {
          "nodeId": "page-load",
          "icon": "ğŸ“„",
          "title": "Page Load",
          "narration": "A user navigates to a page. RouteGuard intercepts before any content renders. Time for security checks!",
          "connectsTo": null
        },
        {
          "nodeId": "is-protected",
          "edges": [{ "from": "page-load", "to": "is-protected" }],
          "icon": "ğŸ”",
          "title": "Protected Check",
          "narration": "First, isProtectedPage checks the URL. Marketing pages pass through. Dashboard and lessons require authentication.",
          "connectsTo": "Page Load"
        },
        {
          "nodeId": "not-protected",
          "edges": [{ "from": "is-protected", "to": "not-protected" }],
          "icon": "ğŸŒ",
          "title": "Public Page",
          "narration": "This is a public page! No authentication required. Content loads immediately for everyone.",
          "connectsTo": "Protected Check"
        },
        {
          "nodeId": "show-loading",
          "edges": [{ "from": "is-protected", "to": "show-loading" }],
          "icon": "â³",
          "title": "Show Loading",
          "narration": "For protected pages, we show a loading screen. Content stays hidden until auth state is confirmed. No flash of forbidden content!",
          "connectsTo": "Protected Check"
        },
        {
          "nodeId": "wait-auth",
          "edges": [{ "from": "show-loading", "to": "wait-auth" }],
          "icon": "â³",
          "title": "Wait for Auth",
          "narration": "waitForAuthState returns a promise. It resolves when Firebase Auth confirms the user's session status. Patient waiting!",
          "connectsTo": "Show Loading"
        },
        {
          "nodeId": "check-user",
          "edges": [{ "from": "wait-auth", "to": "check-user" }],
          "icon": "ğŸ‘¤",
          "title": "Check User",
          "narration": "Auth state resolved! Now we checkâ€”is there a current user? Signed in or anonymous? This decides the next step.",
          "connectsTo": "Wait Auth"
        },
        {
          "nodeId": "redirect-login",
          "edges": [{ "from": "check-user", "to": "redirect-login" }],
          "icon": "ğŸ”™",
          "title": "Redirect to Login",
          "narration": "No user signed in! Redirect to the login page with a return URL. After login, they'll come right back here.",
          "connectsTo": "Check User"
        },
        {
          "nodeId": "check-rbac",
          "edges": [{ "from": "check-user", "to": "check-rbac" }],
          "icon": "ğŸ›¡ï¸",
          "title": "RBAC Verification",
          "narration": "With authentication confirmed, RBAC kicks in. Does this user have permission for this specific page and course?",
          "connectsTo": "Check User"
        },
        {
          "nodeId": "allow",
          "edges": [{ "from": "check-rbac", "to": "allow" }],
          "icon": "âœ…",
          "title": "Show Content",
          "narration": "All checks passed! The loading screen fades, content appears, and the user can interact. RouteGuard's job is done!",
          "connectsTo": "RBAC Check"
        },
        {
          "nodeId": "deny",
          "edges": [{ "from": "check-rbac", "to": "deny" }],
          "icon": "ğŸš«",
          "title": "Access Denied",
          "narration": "RBAC check failed! User doesn't have permission. Show an error message and offer navigation alternatives.",
          "connectsTo": "RBAC Check"
        }
      ]
    },
    {
      "id": "org-access-story",
      "diagramId": "org-access",
      "title": "Organization Access",
      "steps": [
        {
          "nodeId": "user1",
          "icon": "ğŸ‘¤",
          "title": "Alice: Standard User",
          "narration": "Meet Alice, a standard user. She can access all public coursesâ€”Apprentice and beyond. No organization membership.",
          "connectsTo": null
        },
        {
          "nodeId": "user2",
          "icon": "ğŸ¢",
          "title": "Bob: Enterprise User",
          "narration": "Bob is an enterprise user with Endless Opportunities. He gets public courses PLUS the exclusive EO Bootcamp content!",
          "connectsTo": null
        },
        {
          "nodeId": "user3",
          "icon": "ğŸ¢",
          "title": "Carol: Partner X Member",
          "narration": "Carol is also enterprise, but with Partner X. Different organization means different exclusive content.",
          "connectsTo": null
        },
        {
          "nodeId": "user4",
          "icon": "ğŸ‘‘",
          "title": "Admin: Full Access",
          "narration": "The admin can access everything! Public courses, all partner courses, every piece of content. Ultimate override authority!",
          "connectsTo": null
        },
        {
          "nodeId": "org-eo",
          "edges": [{ "from": "user2", "to": "org-eo" }],
          "icon": "ğŸ¤",
          "title": "Endless Opportunities",
          "narration": "Bob's user document lists Endless Opportunities in his organizations array. This unlocks EO-specific content.",
          "connectsTo": "Bob"
        },
        {
          "nodeId": "org-x",
          "edges": [{ "from": "user3", "to": "org-x" }],
          "icon": "ğŸ¤",
          "title": "Partner X Organization",
          "narration": "Carol belongs to Partner X. Her organization membership grants access to Partner X's exclusive courses.",
          "connectsTo": "Carol"
        },
        {
          "nodeId": "course-public",
          "edges": [{ "from": "user1", "to": "course-public" }, { "from": "user2", "to": "course-public" }, { "from": "user3", "to": "course-public" }, { "from": "user4", "to": "course-public" }],
          "icon": "ğŸ“š",
          "title": "Public Courses",
          "narration": "The Apprentice course is publicâ€”everyone with an account can access it. Alice, Bob, Carol, and Admin all qualify.",
          "connectsTo": "All Users"
        },
        {
          "nodeId": "course-eo",
          "edges": [{ "from": "org-eo", "to": "course-eo" }, { "from": "user4", "to": "course-eo" }],
          "icon": "ğŸ“˜",
          "title": "EO Bootcamp",
          "narration": "The EO Bootcamp is linked to Endless Opportunities. Only Bob and Admin can accessâ€”Carol and Alice cannot.",
          "connectsTo": "EO Org, Admin"
        },
        {
          "nodeId": "course-x",
          "edges": [{ "from": "org-x", "to": "course-x" }, { "from": "user4", "to": "course-x" }],
          "icon": "ğŸ“™",
          "title": "Partner X Course",
          "narration": "Partner X's course is exclusive to their members. Carol and Admin can access itâ€”Bob and Alice cannot.",
          "connectsTo": "Partner X, Admin"
        }
      ]
    }
  ],
  "quizzes": [
    {
      "storyId": "role-hierarchy-story",
      "questions": [
        {
          "question": "What permissions does the enterprise role inherit?",
          "options": ["Admin permissions", "All standard user permissions", "Only partner course access", "No inherited permissions"],
          "correct": 1,
          "explanation": "Enterprise users inherit all standard user permissions plus access to partner courses for their organization."
        },
        {
          "question": "What is the highest role in the platform?",
          "options": ["Enterprise", "Super", "Admin", "Owner"],
          "correct": 2,
          "explanation": "Admin is the highest role with full platform accessâ€”all courses, user management, and organization controls."
        }
      ]
    },
    {
      "storyId": "access-check-story",
      "questions": [
        {
          "question": "What happens when an admin requests any resource?",
          "options": ["Same checks as other users", "Skip all checks, access granted immediately", "Only skip auth check", "Extra verification required"],
          "correct": 1,
          "explanation": "Admins bypass all permission checksâ€”if role equals admin, access is granted immediately."
        },
        {
          "question": "In what order are access checks performed?",
          "options": ["Role â†’ Auth â†’ Org", "Auth â†’ Admin â†’ Course â†’ Org", "Org â†’ Role â†’ Auth", "Course â†’ Org â†’ Auth"],
          "correct": 1,
          "explanation": "Checks flow: Authentication first, then admin bypass check, then public/course requirements, then organization membership."
        }
      ]
    },
    {
      "storyId": "route-guard-story",
      "questions": [
        {
          "question": "Why does RouteGuard show a loading screen?",
          "options": ["To improve SEO", "To prevent flash of forbidden content", "Required by Firebase", "For animation purposes"],
          "correct": 1,
          "explanation": "The loading screen prevents any flash of protected content before authentication status is confirmed."
        }
      ]
    }
  ]
}
